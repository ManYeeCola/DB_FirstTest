<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
    <link href="css/mui.min.css" rel="stylesheet"/>
    <title></title>
	<style>
		.mui-sup{color: #ff0000;background-color: #ffffff;width: 10px;}
		.mui-rep:after{content: '*';}
		.mui-comments{color:#888888;font-size: 14px;}
	</style>
</head>
<body>
	<header class="mui-bar mui-bar-nav">
	      <h1 class="mui-title" style="color: #0095ff;font-size: 20px;"><strong>非公12-28通用模板签到活动</strong></h1>
	</header>
	<div class="mui-content" id="commonQuestion">

	</div>
	<footer class="mui-bar mui-bar-footer">
		<div class="mui-text-center">
			<button class="mui-btn mui-btn-primary mui-col-sm-8 mui-col-xs-8" onclick="GenerateDom()">提交</button>
		</div>
	</footer>
</body>
    <script src="js/mui.min.js"></script>
    <script type="text/javascript" charset="utf-8">
		//mui.init();
		var atpTemplate
		window.onload=(function(){
			GetAptTemplate()
		})
		
		function GenerateDom(){
			document.getElementById("commonQuestion").innerHTML=""
			let input=0
			let radio=1
			let checkbox=2
			var req,qtitle,questions,content;
			let template=atpTemplate.TemplateInfo
			let commonq=GetCommonData()
			var groups=[
				{ID:0 ,Name:"通用",questions:[]},
				{ID:1 ,Name:"早癌",questions:[]},
				{ID:2 ,Name:"超声",questions:[]},
				{ID:3 ,Name:"呼吸",questions:[]},
				{ID:4 ,Name:"小肠镜",questions:[]},
			]
			groups.forEach(group=>{
				group.questions=commonq.TempQuestionInfos.filter(question=>question.Group.ID==group.ID)
				group.questions.push.apply(template.TempQuestionInfos.filter(question=>question.Group.ID==group.ID))
			})
			groups[0].questions.forEach((question,index)=>{
				content=""
				req=question.Required?"mui-rep":"",
				
				qtitle=`<div>
							<sup class="mui-sup `+req+` mui-badge"></sup>
							<strong>`+(index+1)+`.`+question.Descrition+`</strong>
							<span class="mui-comments">`+((question.Type==checkbox)?"[多选]":"")+`</span>
						</div>`
				switch (question.Type){
					case input:
						content=(question.MaxLength<=50)?//当前根据文本输入框的最大长度大于50 即可
							`<div class="mui-input-row">
								<input type="text" class="mui-input-clear" id="question_`+question.ID+`"  maxlength="`+question.MaxLength+`">
							</div>`:
							`<div class="mui-input-row">
								<textarea class="mui-input-clear" id="question_`+question.ID+`" maxlength="`+question.MaxLength+`"></textarea>
							</div>`
						break;
					case radio:
						question.TempQuOptionInfos.forEach(option=>{
							content+= `<div class="mui-input-row mui-radio  mui-left">
							  <label>`+option.Descrition+`</label>
							  <input name="question_`+question.ID+`" value="`+option.ID+`" type="radio">
							</div>`
						})
						break;
					case checkbox:
						question.TempQuOptionInfos.forEach(option=>{
							content+= `<div class="mui-input-row mui-checkbox mui-left">
							  <label>`+option.Descrition+`</label>
							  <input name="question_`+question.ID+`" value="`+option.ID+`" type="checkbox">
							</div>`
						})
						break;
				}
				 
				questions=`<div class="mui-card">
								<div class="mui-card-header ">`
									+qtitle+
								`</div>
								<div class="mui-card-content-inner ">`
									+content+
								`</div>
							</div>`
				//document.getElementById("commonQuestion").insertAdjacentHTML('beforeend',questions)
				//$("#commonQuestion").append(questions)
				mui("#commonQuestion")[0].insertAdjacentHTML('beforeend',questions)
			})
			//$("#commonQuestion").append(`<footer class="mui-card-footer"></footer>`)
			//document.getElementById("commonQuestion").insertAdjacentHTML('beforeend',`<footer class="mui-card-footer"></footer>`)
			mui("#commonQuestion")[0].insertAdjacentHTML('beforeend',`<footer class="mui-card-footer"></footer>`)
		}
		function GetAptTemplate(){
			atpTemplate=mui.getJSON(
				'@Url.Action("","")',
				{category:'news'},
				function(result){
					result=JSON.parse(result)
					GenerateDom()
				}
			);
		}

		function GetCommonData(){
			mui.getJSON(
				'@Url.Action("","")',
				{category:'news'},
				function(result){
					result=JSON.parse(result)
					return result.JsonObjects
				}
			);
		}

		function SaveAnswer(){
			
			let AptAttendance={
				AptTemplateID:atpTemplate.ID,
				AptAttAnswerInfos:[
					{},
					{}
				]
			}
		}
    </script>
</html>